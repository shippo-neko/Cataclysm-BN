# 近接武器のバランス調整スプレッドシート

![スプレッドシード](https://github.com/cataclysmbnteam/Cataclysm-BN/assets/54838975/1fa4f7ec-2965-4247-a592-94f246b13662)

これは、「`Melee Weapons Evaluation.ods`」(近接武器評価) スプレッドシートに関するドキュメンテーションです。このスプレッドシートは、0.E 開発版の近接武器のバランス調整プロジェクトです。オリジナルのスプレッドシートは
[google doc](https://docs.google.com/spreadsheets/d/14eQIe4AO_f6OxCt1XcB4NLAs6-5R1wQW-ydZG0orYdY/edit#gid=1787713396)として利用可能ですが、内容が移動する事態に備えて静的コピーが保存されています。

これは多くの可動要素を持つ複雑なスプレッドシートです。以下に、各タブとデータの流れを説明します。

### 生データ (Raw)

生データは、mlangsdorf氏のMOD群を用いた 2019年10月頃の 0.D 開発版から取得された初期データでした。
（そのため、Blazemod 関連の要素が含まれています）。タブには、以下の追加カテゴリーが設けられています。

- Weapon Class(武器ランク) - 数値評価です。0は武器ではない、1は爆発装置、2は投擲武器または銃器、3は
  調理鍋のような粗悪な武器となるツール、4はヘルメット、5はスレッジハンマーのような良好な武器となるツール、6は即席または偽造された武器、そして7は専用の武器を意味します。
- Category(カテゴリ) - 類似の武器を比較しやすくするために、アイテムを武器として分類したものです。近接武器
  のカテゴリーには、Ax(斧)、Ax2(両手斧)、Club(棍棒)、Club2(両手棍棒)、Flail(フレイル)、Flail2(両手フレイル)、Knife(ナイフ)、Polearm(ポールアーム)、Spear(槍)
  Staff(杖)、Shortsword(短剣)、Sword(片手剣)、Sword2(両手剣)があります。 末尾に 2 が付くカテゴリは両手持ち武器です。
- Acc (命中精度) - 以下の命中精度係数に基づき再計算した武器の命中精度です。これは、データのレビューによ
  り、多くの武器の命中精度が GAME_BALANCE.mdの基準の裏付けがないことが判明したためです。
- Grip (グリップ)- GAME_BALANCE.md に記載されているアイテムの「グリップ」です。
- Leng (長さ)- GAME_BALANCE.mdに記載されているアイテムの「長さ」です。
- Surf (打撃面)- GAME_BALANCE.mdに記載されているアイテムの「打撃面」です。
- Bal (バランス)- GAME_BALANCE.mdに記載されているアイテムの「バランス」です
  不器用(Clumsy)に加えて追加のカテゴリーが追加され、目視で割り当てられました。

### フィルター (Filter)

Filterタブは、Rawから初期データを取得し、（セルB1で指定された）武器分類をもとに、それより低い武器分類のアイテムを除外することで、さらなる分析を容易にします。

### 新評価式 (New Formula)

このタブでは、初期のステータスに基づいて新しい武器評価式を計算します。この計算は複雑です。

最初の7行はヘッダーデータです。計算の大部分は8行目から開始されます。

武器は、筋力 10、器用 10、知覚 10、および全ての武器スキル4のサバイバーを使用して評価されました。基本命中率、能力によるクリティカル、スキルによるクリティカル、打撃倍率、切断倍率、刺突倍率の値は、`src/melee.cpp` の関連部分から抽出されています。

- 列A 「Average」(平均) は、武器の新しい評価値であり、参照しやすいようにシートの端に配置されています。
- 列B-J は、Filterタブを介して Rawタブから取得された武器の元のステータスです。
- 列K 「roll_hit」(命中率) は、評価者の base_hit と accの合計です。
- 列L 「Wpn Crit」(武器クリティカル) は、武器によるクリティカルヒット率です。
- 列M-N 「3 Crit」と「2 Crit」は、スキル、命中精度、およびステータスに基づいて発生するトリプルクリティカ
  ルとダブルクリティカルの確率です。
- 列O-Q 「Average Non-Crit」(非クリティカル平均ダメージ) は、3つのカテゴリー (打撃、切断、刺突)の、装甲を
  考慮せずに計算された非クリティカルヒットによる平均ダメージです。

ここまでは比較的単純です。次の3つのブロックが複雑な部分です。列 S〜Zは、異なるモンスターのステータスを用いて AB～AI、AK～AR として繰り返されます。

- 行 S「Hits」(命中数) は 5 ✕ ( roll_hit - monster Dodge ) 平均値と、25の標準偏差を持つ正規分布に対して計
  算された、1000回の攻撃あたりの予想命中数です。
- 行 T「Crit %s」(クリティカル率) は、命中数のうち、クリティカルヒットであるべき割合です。
- 行 U「Dmg」(ダメージ) は、アーマーを通過した予想平均ダメージです。これは、3つのダメージタイプそれぞれに
  ついて max(0,damage type - armor amount) を合計したものです。
- 行 V「Crit」(クリティカルダメージ) は、アーマーを通過した予想平均クリティカルダメージです。これは、3つ
  のダメージ量それぞれについてクリティカルダメージ - 装甲値を合計したものです。
  3つのダメージタイプは異なるクリティカルダメージ乗数を持つため、またクリティカル時に有効装甲値を異なる量で減少させるため、その計算式は実質的により複雑になります。
- 行 W-Y は、ラピッドストライク（連撃）の場合のダメージとクリティカルダメージを繰り返しますが、この場合、基本ダメージは 2/3倍されます。
- 行 Z「Dmg/Turn」(ターンあたりのダメージ) は、以下のいずれかです。
  100 * ( Dmg * ( Hits - num crits ) + Crit Dmg * ( num hits ) ) / (
  1000 * Moves ) - 非クリティカルヒットごとのダメージ + クリティカルヒットごとのクリティカルダメージ
  の合計を1000回の攻撃に必要なムーブ数で割った値に、100 moves/秒を掛けたもの。 100 * (
  Dmg * ( Hits - num crits ) / 2 + Crit Dmg * ( num hits ) / 2 + rapid strike Dmg * ( Hits - num
  crits ) / 2 + rapid strike Crit Dmg * ( num hits ) / 2 ) / ( 1000 - ( hits / 2 ) * Moves + Hits *
  0.33 * Moves ) - 上記と同じですが、連撃によるダメージの減少と行動コストを考慮に入れています。

最後に、

- 列 AT 「Weapon」(武器) は、参照用の武器名の繰り返しです。
- 列 Au 「Value」(値) は、列 Z、AI、AR、の平均であり、リーチ2の武器では1.5倍、リーチ3の武器では 1.75倍されています。

### 新評価式ソート (New Formula Sorted)

このタブでは、古い武器の評価値と新評価式からの値を比較し、武器を武器カテゴリ別に新しい評価値の降順でソートします。これにより、そのカテゴリにしては異常に優れている（ブロードソード、あなたのことですよ）または劣っている武器を簡単に見つけられるようになります。

### 提案値

このタブは New Formulaタブを繰り返していますが、列C-Jのデータがコピーされ値として貼り付けられ、その後、数値を見栄え良くするために調整されています。

- 命中精度は、Raw タブのグリップ、長さ、打撃面、およびバランスに基づいた新しい値に調整されました。これに
  より、以前は高命中だったバイオニック・クローのような多くの武器が弱体化され、不適切に低命中だったカタナのような武器が強化されました。
- 同じカテゴリ内の武器は、値は異なるものの、全体としてほぼ同じ評価になるように調整されました。一般に、ヨ
  ーロッパ系武器はダメージの多くが打撃から来て、切断からは少なく、アジア系武器よりも重く遅い傾向があります。これは少し恣意的で完全に現実的ではありませんが、皆がそれを期待しているようです。例として、日本の両手剣「野太刀 (nodachi)」は、攻撃速度164、打撃6、切断47 であるのに対し、ヨーロッパの両手剣「ツヴァイヘンダー (zweihander)」は、攻撃速度169、打撃18、切断39 です。どちらも評価値は約26 です。
- 劣化武器は、本物の武器と比較してバランスに 1 ステップのペナルティを受け、切断/刺突ダメージの半分が
  打撃に移動し、残りの切断/刺突ダメージは本物の武器の 1/4 です。すなわち、劣化したパイクは、本物のパイク(打撃8、刺突44)に対して、打撃30、刺突11 になります。
- 偽造武器 (Fake weapons) は、武器の劣化版と同じくらいバランスが悪く設定されていますが、基本的に鈍器であ
  るため、皮肉なことに打撃面が通常「(すべて)」にアップグレードされ、本物の武器と同じかそれ以上の精度になります。打撃ダメージは劣化版の半分にされ、切断/刺突ダメージは劣化版のさらに 1/4 (本物の武器の 1/16) に減らされました。偽造パイクは、打撃15、刺突3 になります。
- 多くの武器が、評価値を引き上げるためにダメージブーストを受けました。連撃を持つ多くの低ダメージ武器が大
  幅に過大評価されていましたが、装甲を通過するダメージテストの結果、連撃は装甲に2倍の速さで跳ね返されるだけに過ぎないことが判明しました。
- 槍には、重量に基づいた刺突ダメージのざっくりとした評価式が適用されましたが、詳細な式はもう再現できませ
  ん。しかし、全体として槍同士の差異は以前よりもマイナーになっています。
- ポールアームは、リーチ2では Ax2 と同じくらいのざっくりとしたダメージが与えられましたが、リーチ1では生
  のダメージを0.7倍に減らした別個のバランスラインが適用されました。これにより、ポールアームは間接攻撃こそ印象的ですが、隣接するターゲットに対してはクォータースタッフよりもわずかに劣るようになります。

### 提案値ソート済み (Poposed Values Sorted)

これは New Formula Sortedと同様の比較タブですが、Proposed Valuesのデータを使用しています。

### 比較 (Comparison)

これは要約タブです。

列 A-Pでは、filter タブからの各武器について、現在のステータスと提案されたステータス、元の評価値、新評価式での評価値、および提案値を使用した新評価式での評価値が表示されます。提案値については、改善された値は緑色、悪化した値は赤色でハイライトされています。これにより、変更点を簡単に比較し、ミスを発見できるようになることが理想です。

例 S-AH はこのプロセスを繰り返しますが、セル S1、T1、U1、および V1 を使用してカテゴリ名を指定でき、小計としてそれらのカテゴリに一致する選択した武器のサブセットが表示されます。これは比較を簡素化します。
